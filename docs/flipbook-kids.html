<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>P.A.G.O Kids — Flipbook</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow: hidden;
    }

    .header {
      text-align: center;
      margin-bottom: 15px;
    }

    .header h1 {
      color: #C8A951;
      font-size: 28px;
      font-weight: 700;
      text-shadow: 0 2px 10px rgba(200, 169, 81, 0.3);
      letter-spacing: 2px;
    }

    .header p {
      color: rgba(255, 255, 255, 0.6);
      font-size: 13px;
      margin-top: 4px;
    }

    .flipbook-container {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
    }

    .flip-book {
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 40px rgba(200, 169, 81, 0.1);
      border-radius: 4px;
    }

    .page {
      background-color: #fff;
      overflow: hidden;
    }

    .page img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .page-cover {
      background: linear-gradient(135deg, #F5E6C8, #E8D5A8);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .page-cover img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* Navigation Buttons */
    .nav-btn {
      background: rgba(200, 169, 81, 0.15);
      border: 2px solid rgba(200, 169, 81, 0.3);
      color: #C8A951;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      font-size: 20px;
      backdrop-filter: blur(10px);
    }

    .nav-btn:hover {
      background: rgba(200, 169, 81, 0.3);
      border-color: #C8A951;
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(200, 169, 81, 0.3);
    }

    .nav-btn:disabled {
      opacity: 0.2;
      cursor: not-allowed;
      transform: none;
    }

    /* Page Counter */
    .page-counter {
      text-align: center;
      margin-top: 15px;
      color: rgba(255, 255, 255, 0.7);
      font-size: 14px;
      letter-spacing: 1px;
    }

    .page-counter span {
      color: #C8A951;
      font-weight: 700;
    }

    /* Thumbnail strip */
    .thumbnails {
      display: flex;
      gap: 6px;
      margin-top: 12px;
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      backdrop-filter: blur(10px);
      overflow-x: auto;
      max-width: 90vw;
    }

    .thumb {
      width: 60px;
      height: 34px;
      border-radius: 3px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.3s ease;
      object-fit: cover;
      opacity: 0.5;
      flex-shrink: 0;
    }

    .thumb:hover {
      opacity: 0.8;
      border-color: rgba(200, 169, 81, 0.5);
    }

    .thumb.active {
      border-color: #C8A951;
      opacity: 1;
      box-shadow: 0 0 10px rgba(200, 169, 81, 0.4);
    }

    /* Fullscreen button */
    .fullscreen-btn {
      position: fixed;
      top: 15px;
      right: 15px;
      background: rgba(200, 169, 81, 0.15);
      border: 1px solid rgba(200, 169, 81, 0.3);
      color: #C8A951;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      z-index: 100;
    }

    .fullscreen-btn:hover {
      background: rgba(200, 169, 81, 0.3);
    }

    /* Loading */
    .loading {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: #1a1a2e;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: opacity 0.5s ease;
    }

    .loading.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(200, 169, 81, 0.2);
      border-top-color: #C8A951;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .loading p {
      color: #C8A951;
      margin-top: 15px;
      font-size: 14px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Keyboard hint */
    .hint {
      position: fixed;
      bottom: 10px;
      right: 15px;
      color: rgba(255, 255, 255, 0.3);
      font-size: 11px;
    }

    @media (max-width: 768px) {
      .header h1 { font-size: 20px; }
      .nav-btn { width: 36px; height: 36px; font-size: 16px; }
      .thumbnails { display: none; }
      .hint { display: none; }
    }
  </style>
</head>
<body>

  <!-- Loading Screen -->
  <div class="loading" id="loading">
    <div class="loading-spinner"></div>
    <p>Carregando P.A.G.O Kids...</p>
  </div>

  <!-- Fullscreen Button -->
  <button class="fullscreen-btn" onclick="toggleFullscreen()">⛶ Tela Cheia</button>

  <!-- Header -->
  <div class="header">
    <h1>✦ P.A.G.O Kids ✦</h1>
    <p>Uma Aventura de Fé para Pequenos Construtores</p>
  </div>

  <!-- Flipbook -->
  <div class="flipbook-container">
    <button class="nav-btn" id="prevBtn" onclick="flipPrev()">◀</button>

    <div id="flipbook" class="flip-book"></div>

    <button class="nav-btn" id="nextBtn" onclick="flipNext()">▶</button>
  </div>

  <!-- Page Counter -->
  <div class="page-counter">
    Página <span id="currentPage">1</span> de <span id="totalPages">12</span>
  </div>

  <!-- Thumbnails -->
  <div class="thumbnails" id="thumbnails"></div>

  <!-- Keyboard Hint -->
  <div class="hint">← → para navegar | F para tela cheia</div>

  <!-- StPageFlip Library -->
  <script src="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/js/page-flip.browser.js"></script>

  <script>
    const totalPages = 12;
    const pageNames = [
      'Capa',
      'Carta aos Pais',
      'Cap. 1 — O Que É o P.A.G.O?',
      'Cap. 2 — Princípio',
      'Cap. 3 — Alinhamento',
      'Cap. 4 — Governo',
      'Cap. 5 — Obediência',
      'Cap. 6 — Os 4 Pilares',
      'Cap. 7 — Desafio de 7 Dias',
      'Declaração P.A.G.O',
      'Glossário',
      'Versículos'
    ];

    let pageFlip;
    let imagesLoaded = 0;

    // Preload images
    function preloadImages() {
      const promises = [];
      for (let i = 1; i <= totalPages; i++) {
        promises.push(new Promise((resolve) => {
          const img = new Image();
          img.onload = () => {
            imagesLoaded++;
            resolve();
          };
          img.onerror = resolve;
          img.src = `/api/flipbook-kids/images/page_${String(i).padStart(2, '0')}.jpg`;
        }));
      }
      return Promise.all(promises);
    }

    // Initialize flipbook
    async function init() {
      await preloadImages();

      const container = document.getElementById('flipbook');

      // Calculate optimal size
      const maxW = Math.min(window.innerWidth * 0.7, 900);
      const maxH = Math.min(window.innerHeight * 0.6, 500);
      const aspectRatio = 1376 / 768;

      let pageW, pageH;
      if (maxW / 2 / maxH > aspectRatio) {
        pageH = maxH;
        pageW = Math.floor(pageH * aspectRatio);
      } else {
        pageW = Math.floor(maxW / 2);
        pageH = Math.floor(pageW / aspectRatio);
      }

      // Create pages
      for (let i = 1; i <= totalPages; i++) {
        const div = document.createElement('div');
        div.className = i === 1 ? 'page page-cover' : 'page';
        const img = document.createElement('img');
        img.src = `/api/flipbook-kids/images/page_${String(i).padStart(2, '0')}.jpg`;
        img.alt = pageNames[i - 1];
        img.loading = 'eager';
        div.appendChild(img);
        container.appendChild(div);
      }

      // Initialize PageFlip
      pageFlip = new St.PageFlip(container, {
        width: pageW,
        height: pageH,
        size: 'fixed',
        minWidth: 300,
        maxWidth: 900,
        minHeight: 200,
        maxHeight: 600,
        maxShadowOpacity: 0.5,
        showCover: true,
        mobileScrollSupport: true,
        swipeDistance: 30,
        clickEventForward: true,
        useMouseEvents: true,
        flippingTime: 800,
        usePortrait: true,
        autoSize: true,
        drawShadow: true,
        startZIndex: 0,
      });

      pageFlip.loadFromHTML(document.querySelectorAll('.page'));

      pageFlip.on('flip', (e) => {
        updatePageCounter(e.data);
        updateThumbnails(e.data);
      });

      // Build thumbnails
      buildThumbnails();
      updatePageCounter(0);

      // Hide loading
      document.getElementById('loading').classList.add('hidden');
    }

    function buildThumbnails() {
      const container = document.getElementById('thumbnails');
      for (let i = 1; i <= totalPages; i++) {
        const img = document.createElement('img');
        img.src = `/api/flipbook-kids/images/page_${String(i).padStart(2, '0')}.jpg`;
        img.className = 'thumb' + (i === 1 ? ' active' : '');
        img.title = pageNames[i - 1];
        img.onclick = () => {
          pageFlip.flip(i - 1);
        };
        container.appendChild(img);
      }
    }

    function updatePageCounter(pageIndex) {
      document.getElementById('currentPage').textContent = pageIndex + 1;
      document.getElementById('totalPages').textContent = totalPages;

      document.getElementById('prevBtn').disabled = pageIndex === 0;
      document.getElementById('nextBtn').disabled = pageIndex >= totalPages - 1;
    }

    function updateThumbnails(pageIndex) {
      const thumbs = document.querySelectorAll('.thumb');
      thumbs.forEach((t, i) => {
        t.classList.toggle('active', i === pageIndex);
      });
    }

    function flipPrev() {
      if (pageFlip) pageFlip.flipPrev();
    }

    function flipNext() {
      if (pageFlip) pageFlip.flipNext();
    }

    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    }

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight' || e.key === ' ') {
        e.preventDefault();
        flipNext();
      } else if (e.key === 'ArrowLeft') {
        e.preventDefault();
        flipPrev();
      } else if (e.key === 'f' || e.key === 'F') {
        toggleFullscreen();
      }
    });

    // Handle resize
    window.addEventListener('resize', () => {
      if (pageFlip) {
        // PageFlip handles resize automatically with autoSize
      }
    });

    // Start
    init();
  </script>
</body>
</html>
